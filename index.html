<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Livslinjen - En svensk resa</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 20px;
            overflow-y: auto;
        }
        .container {
            max-width: 1200px;
            width: 100%;
            margin: 20px auto;
            padding: 0 10px;
        }
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        .header h1 {
            font-size: 2.3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .header p {
            font-size: 1.0em;
        }
        .game-screen {
            background: rgba(255, 255, 255, 0.97);
            border-radius: 15px;
            padding: 20px 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            margin-bottom: 20px;
        }
        .character-info, .decade-summary, .life-goal-selection {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 5px solid #007bff;
        }
        .character-info h3, .decade-summary h3, .life-goal-selection h3 {
            margin-top:0;
            margin-bottom: 15px;
            color: #0056b3;
            font-size: 1.3em;
        }
        .life-goal-selection label {
            display: block;
            margin-bottom: 10px;
            background-color: #fff;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
            cursor: pointer;
            font-size:0.95em;
        }
        .life-goal-selection label:hover {
            background-color: #e9ecef;
        }
        .life-goal-selection input[type="radio"] {
            margin-right: 10px;
        }
        .character-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(170px, 1fr));
            gap: 12px;
            margin-top: 15px;
        }
        .stat-item {
            background: white;
            padding: 8px 10px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            font-size: 0.85em;
        }
        .stat-item strong {
            color: #007bff;
        }
        .timeline-container {
            margin: 20px 0;
            padding: 15px;
            background-color: #f0f0f0;
            border-radius: 10px;
        }
        .timeline-container h3 {
            color: #333;
            margin-bottom: 5px;
            font-size: 1.2em;
        }
        .timeline-container p {
            font-size: 0.9em;
            margin-bottom: 8px;
        }
        .timeline-grid-container {
            border: 1px solid #ccc;
            padding: 5px;
            background-color: #e9ecef;
            border-radius: 5px;
            margin-bottom: 10px;
            overflow-x: auto;
        }
        .timeline-track {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 3px;
            margin-bottom: 3px;
            min-height: 45px;
            border-bottom: 1px dashed #d0d0d0;
        }
        .timeline-track:last-child {
            border-bottom: none;
        }
        .timeline-year-cell {
            background-color: #fff;
            border: 1px solid #dcdcdc;
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7em;
            color: #777;
            min-width: 50px;
            position: relative;
            cursor: pointer;
        }
        .timeline-year-cell:hover {
            background-color: #e3f2fd;
        }
        .timeline-year-cell.occupied {
            font-weight: bold;
            color: white;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            padding: 2px;
            cursor: default;
        }
        #currentProjectsDisplay {
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 5px;
            margin-top:10px;
        }
        #currentProjectsDisplay h4 {
            font-size: 1em;
            margin-bottom: 8px;
        }
        #currentProjectsDisplay p {
            margin: 5px 0;
            font-size: 0.9em;
        }
        #currentProjectsDisplay .project-entry {
            padding: 6px 8px;
            margin-bottom: 5px;
            border-radius: 4px;
            color: white;
            font-weight: bold;
            font-size: 0.85em;
        }
        #currentProjectsDisplay .project-entry small {
            font-weight:normal;
            font-size:0.9em;
            display:block;
        }
        .project-menu {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .project-category {
            background: white;
            border-radius: 10px;
            padding: 15px;
            border: 2px solid #dee2e6;
            transition: all 0.3s ease;
        }
        .project-category:hover {
            border-color: #007bff;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .project-category h4 {
            margin-bottom: 10px;
            color: #495057;
            border-bottom: 2px solid #007bff;
            padding-bottom: 5px;
            font-size: 1.1em;
        }
        .project-item {
            background: #f8f9fa;
            padding: 10px 12px;
            margin: 8px 0;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid transparent;
            font-size: 0.9em;
        }
        .project-item strong {
            display: block;
            margin-bottom: 3px;
            font-size: 1.05em;
        }
        .project-item:hover {
            background: #e3f2fd;
            border-color: #007bff;
        }
        .project-item.disabled {
            background: #e9ecef;
            color: #6c757d;
            cursor: not-allowed;
            opacity: 0.7;
        }
        .project-item .details {
            display: block;
            font-size: 0.8em;
            color: #555;
            margin-top: 4px;
            line-height: 1.3;
        }
        .project-item .costs, .project-item .benefits {
            font-size: 0.75em;
            color: #444;
        }
        .historical-events, .random-event-display {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
        }
        .historical-events h3, .random-event-display h3 {
            color: #856404;
            margin-bottom: 10px;
            font-size: 1.2em;
        }
        .historical-events ul, .random-event-display ul {
            list-style-position: inside;
            padding-left: 0;
            font-size:0.9em;
        }
        .historical-events li, .random-event-display li {
            margin-bottom: 5px;
        }
        .random-event-display p {
            margin-bottom: 5px;
        }
        .controls {
            display: flex;
            gap: 15px;
            margin: 25px 0 10px 0;
            justify-content: center;
            flex-wrap: wrap;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 0.95em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .btn-primary {
            background: linear-gradient(45deg, #007bff, #0056b3);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,123,255,0.3);
        }
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        .btn-secondary:hover {
            background: #545b62;
        }
        .btn-danger {
            background: linear-gradient(45deg, #dc3545, #c82333);
            color: white;
        }
        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(220,53,69,0.3);
        }
        .decade-header {
            text-align: center;
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .decade-header h2 {
            font-size: 1.6em;
            margin-bottom: 3px;
        }
        .decade-header p {
            font-size: 0.9em;
        }
        .reflection-screen {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px 30px;
            margin: 20px 0;
        }
        .reflection-screen h2, .summary-screen h2 {
            text-align: center;
            color: #0056b3;
            margin-bottom: 20px;
            font-size: 1.5em;
        }
        .life-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .summary-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #007bff;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .summary-card h4 {
            color: #007bff;
            margin-bottom: 10px;
            font-size: 1.15em;
        }
        .summary-card ul {
            list-style-type: none;
            padding-left: 0;
            font-size: 0.9em;
        }
        .summary-card li {
            margin-bottom: 8px;
        }
        .summary-card li ul {
            margin-left: 15px;
            margin-top: 5px;
        }
        .summary-card li ul li {
            font-size: 0.95em;
            margin-bottom: 4px;
        }
        .summary-card p {
            font-size: 0.9em;
            line-height: 1.5;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            align-items: center;
            justify-content: center;
            padding: 15px;
        }
        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 15px;
            max-width: 480px;
            width: 100%;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .modal-content h3 {
            color: #007bff;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        .modal-content p {
            margin-bottom: 15px;
            line-height: 1.6;
            font-size: 0.95em;
        }
        .modal-content .effects {
            font-size: 0.85em;
            color: #555;
            margin-top:10px;
            padding-top:10px;
            border-top: 1px solid #eee;
            text-align:left;
        }
        .intro-screen {
            text-align: left;
            padding: 20px 25px;
        }
        .intro-screen h2 {
            color: #007bff;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.6em;
        }
        .intro-screen h3 {
            color: #0056b3;
            margin-top: 18px;
            margin-bottom: 8px;
            font-size: 1.2em;
        }
        .intro-screen p, .intro-screen li {
            font-size: 0.95em;
            line-height: 1.6;
            margin-bottom: 8px;
            color: #333;
        }
        .intro-screen ul {
            list-style-position: inside;
            margin-left: 5px;
            margin-bottom:12px;
        }
        .intro-screen ul ul {
            margin-left: 20px;
            margin-top: 5px;
        }
        .intro-screen strong {
            color: #0056b3;
        }
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            .container {
                padding: 0px;
            }
            .game-screen {
                padding: 15px;
            }
            .header h1 {
                font-size: 1.8em;
            }
            .project-menu {
                grid-template-columns: 1fr;
            }
            .character-stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üá∏üá™ Livslinjen - En svensk resa</h1>
            <p>Ett sociologiskt simulationsspel om att v√§xa upp i Sverige 1960-2020</p>
        </div>

        <div id="gameArea" class="game-screen">
            <div id="introScreen" class="intro-screen">
                <h2>V√§lkommen till Livslinjen!</h2>
                <p>Du √§r p√• v√§g att forma ett liv genom sex decennier i Sverige, fr√•n 1960-talet till 2010-talet. Dina val kommer att p√•verkas av samh√§llsf√∂r√§ndringar, din bakgrund och dina personliga str√§vanden.</p>

                <h3>S√• h√§r fungerar spelet:</h3>
                <ul>
                    <li><strong>Karakt√§r:</strong> I b√∂rjan slumpas din karakt√§rs k√∂n, f√∂delseort och sociala bakgrund, vilket ger dig olika startf√∂ruts√§ttningar. Du f√•r ocks√• v√§lja ett √∂vergripande livsm√•l.</li>
                    <li><strong>Decennier:</strong> Spelet √§r indelat i decennier (10-√•rsperioder). F√∂r varje decennium √•ldras din karakt√§r och du st√§lls inf√∂r nya val. Historiska h√§ndelser specifika f√∂r decenniet presenteras och kan p√•verka ditt liv.</li>
                    <li><strong>Resurser:</strong> Dina val och m√∂jligheter styrs av olika resurser som du b√•de investerar och bygger upp:
                        <ul>
                            <li><strong>Ekonomiskt kapital:</strong> Pengar som investeras i projekt, boende etc. Tj√§nas fr√§mst genom arbete.</li>
                            <li><strong>Kulturellt kapital:</strong> Kunskap, utbildning, f√§rdigheter. Investeras genom utbildning, ger tillg√•ng till vissa yrken.</li>
                            <li><strong>Socialt kapital:</strong> N√§tverk, v√§nner, familj. Byggs genom relationer, ger st√∂d och √∂ppnar d√∂rrar.</li>
                            <li><strong>Symboliskt kapital:</strong> Status, anseende. F√•s genom karri√§r, utbildning och samh√§llsengagemang.</li>
                            <li><strong>Anstr√§ngningstid:</strong> Varje decennium har du 100 enheter "anstr√§ngning" att f√∂rdela p√• projekt.</li>
                        </ul>
                    </li>
                    <li><strong>Projekt & tidslinje:</strong> Inom varje decennium v√§ljer du projekt inom livets dom√§ner: <strong>utbildning, arbete, familj, fritid,</strong> och <strong>kulturellt engagemang</strong>.
                        <ul>
                            <li>Varje projekt har en <strong>varaktighet</strong> (1-10 √•r) som upptar plats p√• din 10-√•riga tidslinje f√∂r decenniet.</li>
                            <li>Projekt har en <strong>kostnad</strong> (investering) i form av anstr√§ngningstid och ofta andra resurser.</li>
                            <li>Projekt ger en <strong>avkastning</strong> i form av √∂kat kapital, f√∂rb√§ttrad h√§lsa/lycka, eller nya m√∂jligheter.</li>
                        </ul>
                    </li>
                    <li><strong>H√§lsa & lycka:</strong> Dessa tv√• m√§tare (0-100) speglar ditt v√§lbefinnande och p√•verkas av dina val och slumpm√§ssiga h√§ndelser.</li>
                    <li><strong>Slumpm√§ssiga h√§ndelser:</strong> Livet √§r of√∂ruts√§gbart! Positiva och negativa h√§ndelser kan intr√§ffa och p√•verka dina resurser.</li>
                </ul>

                <p><strong>M√•l & reflektion:</strong> Spelets syfte √§r att l√•ta dig utforska hur olika liv kan formas av b√•de personliga val och samh√§lleliga strukturer. Det finns inga "r√§tta" eller "fel" v√§gar. Kom ih√•g att detta √§r en f√∂renklad modell ‚Äì verkliga livet √§r o√§ndligt mycket rikare och mer komplext. Lycka till!</p>

                <div class="controls">
                    <button class="btn btn-primary" onclick="showCharacterCreation()">B√∂rja din resa</button>
                </div>
            </div>

            <div id="characterScreen" style="display: none;">
                <h2>Din karakt√§r genereras...</h2>
                <div id="characterInfo" class="character-info"></div>
                <div id="lifeGoalSelection" class="life-goal-selection">
                    <h3>V√§lj ditt √∂vergripande livsm√•l:</h3>
                    <label><input type="radio" name="lifeGoal" value="happiness" checked> Maximal lycka: Fokusera p√• v√§lbefinnande och positiva upplevelser.</label>
                    <label><input type="radio" name="lifeGoal" value="wealth"> Ekonomisk framg√•ng: Str√§va efter rikedom och materiell trygghet.</label>
                    <label><input type="radio" name="lifeGoal" value="family"> Stark familj: Prioritera n√§ra relationer och familjeliv.</label>
                    <label><input type="radio" name="lifeGoal" value="knowledge"> Kulturell rikedom: S√∂k kunskap, utbildning och kulturella erfarenheter.</label>
                    <label><input type="radio" name="lifeGoal" value="status"> H√∂gt anseende: Arbeta f√∂r status, erk√§nnande och inflytande.</label>
                </div>
                <div class="controls">
                    <button class="btn btn-primary" onclick="confirmCharacterAndGoal()">Forts√§tt till f√∂rsta decenniet</button>
                </div>
            </div>

            <div id="gameplayScreen" style="display: none;">
                <div id="decadeHeader" class="decade-header"></div>
                <div id="characterDisplay" class="character-info"></div>

                <div id="randomEventModal" class="modal">
                    <div class="modal-content">
                        <h3 id="randomEventTitle"></h3>
                        <p id="randomEventDescription"></p>
                        <div id="randomEventEffects" class="effects"></div>
                        <button class="btn btn-primary" onclick="closeModal('randomEventModal')">OK</button>
                    </div>
                </div>

                <div id="historicalEventsDisplay" class="historical-events"></div>

                <div class="timeline-container">
                    <h3>Din planering f√∂r detta decennium (10 √•r)</h3>
                    <p>Anstr√§ngningstid anv√§nt: <span id="effortTimeSpent">0</span> / <span id="totalEffortTimePerDecade">100</span> enheter.</p>
                    <div class="timeline-grid-container" id="timelineGridContainer"></div>
                    <div id="currentProjectsDisplay">
                        <h4>Valda projekt:</h4>
                        <p><em>Inga projekt valda √§n. Klicka p√• ett projekt nedan och sedan p√• en ledig startplats i tidslinjen.</em></p>
                    </div>
                </div>

                <div class="project-menu" id="projectMenu"></div>

                <div class="controls">
                    <button class="btn btn-danger" onclick="clearCurrentDecadeProjects()">Rensa valda projekt</button>
                    <button class="btn btn-primary" onclick="completeDecade()">Slutf√∂r decennium</button>
                </div>
            </div>

            <div id="reflectionScreen" style="display: none;" class="reflection-screen">
                <h2>Reflektion √∂ver ditt decennium</h2>
                <div id="reflectionContent" class="decade-summary"></div>
                <div id="decadeEvents" class="random-event-display" style="display:none;">
                    <h3>H√§ndelser detta decennium:</h3>
                    <ul></ul>
                </div>
                <div class="controls">
                    <button class="btn btn-primary" id="nextDecadeButton" onclick="nextDecade()">N√§sta decennium</button>
                </div>
            </div>

            <div id="summaryScreen" style="display: none;" class="reflection-screen">
                <h2>Din livsresa - sammanfattning</h2>
                <div id="lifeSummary" class="life-summary"></div>
                <div id="finalStats" class="character-info"></div>
                <div id="lifeGoalReflection" class="decade-summary" style="margin-top:20px;"></div>
                <div class="summary-card" style="margin-top:20px;">
                    <h4>En sista reflektion</h4>
                    <p>Detta var en m√∂jlig livsresa, formad av dina val, din bakgrund och en portion slump. Verkligheten √§r o√§ndligt mycket mer komplex och nyanserad, fylld av djupare relationer, fler valm√∂jligheter och h√§ndelser vi inte kan f√∂rutse.</p>
                    <p>Vi hoppas att denna simulerade resa har gett upphov till tankar kring hur olika liv formas och vilka faktorer som spelar in ‚Äì b√•de de vi kan p√•verka och de som ligger utanf√∂r v√•r kontroll. Vad tar du med dig fr√•n din karakt√§rs livslinje?</p>
                </div>
                <div class="controls">
                    <button class="btn btn-primary" onclick="restartGame()">Spela igen</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Game State
        let gameState = {};
        const INITIAL_EFFORT_TIME_PER_DECADE = 100;
        const YEARS_PER_DECADE = 10;
        const TIMELINE_TRACKS = 3;
        let selectedProjectForPlacement = null;

        function getDefaultGameState() {
            const initialTimeline = [];
            for (let i = 0; i < TIMELINE_TRACKS; i++) {
                initialTimeline.push(new Array(YEARS_PER_DECADE).fill(null));
            }
            return {
                character: null,
                currentDecadeIndex: 0,
                decades: ['1960-tal', '1970-tal', '1980-tal', '1990-tal', '2000-tal', '2010-tal'],
                age: 10,
                currentDecadeTimeline: initialTimeline,
                currentDecadeSelectedProjects: [],
                allCompletedProjects: [],
                completedUniqueProjectIds: new Set(),
                capital: { economic: 0, cultural: 0, social: 0, symbolic: 0, time: INITIAL_EFFORT_TIME_PER_DECADE },
                stats: { health: 80, happiness: 60 },
                constraints: {
                    education_level: 'grundskola',
                    hasJob: false,
                    isMarried: false,
                    hasFamily: false,
                    hasChildren: false,
                    currentHousing: 'hos f√∂r√§ldrar/motsv.'
                },
                decadeLog: []
            };
        }

        // Life Goals Data
        const lifeGoalsData = {
            happiness: {
                name: "Maximal lycka",
                description: "Fokusera p√• v√§lbefinnande och positiva upplevelser.",
                bonus_info: "Ger bonus till lyckopo√§ng fr√•n projekt och h√§ndelser."
            },
            wealth: {
                name: "Ekonomisk framg√•ng",
                description: "Str√§va efter rikedom och materiell trygghet.",
                bonus_info: "Ger bonus till ekonomiskt kapital fr√•n projekt och h√§ndelser."
            },
            family: {
                name: "Stark familj",
                description: "Prioritera n√§ra relationer och familjeliv.",
                bonus_info: "Ger bonus till socialt kapital relaterat till familj och relationer."
            },
            knowledge: {
                name: "Kulturell rikedom",
                description: "S√∂k kunskap, utbildning och kulturella erfarenheter.",
                bonus_info: "Ger bonus till kulturellt kapital fr√•n utbildning och kulturprojekt."
            },
            status: {
                name: "H√∂gt anseende",
                description: "Arbeta f√∂r status, erk√§nnande och inflytande.",
                bonus_info: "Ger bonus till symboliskt kapital fr√•n karri√§r och engagemang."
            }
        };

        // Cities and Social Classes
        const swedishCities = [
            { name: 'Stockholm', region: 'Stockholms l√§n', weight: 0.25 },
            { name: 'G√∂teborg', region: 'V√§stra G√∂talands l√§n', weight: 0.15 },
            { name: 'Malm√∂', region: 'Sk√•ne l√§n', weight: 0.10 },
            { name: 'Uppsala', region: 'Uppsala l√§n', weight: 0.08 },
            { name: 'V√§ster√•s', region: 'V√§stmanlands l√§n', weight: 0.05 },
            { name: '√ñrebro', region: '√ñrebro l√§n', weight: 0.05 },
            { name: 'Link√∂ping', region: '√ñsterg√∂tlands l√§n', weight: 0.05 },
            { name: 'Helsingborg', region: 'Sk√•ne l√§n', weight: 0.05 },
            { name: 'J√∂nk√∂ping', region: 'J√∂nk√∂pings l√§n', weight: 0.04 },
            { name: 'Norrk√∂ping', region: '√ñsterg√∂tlands l√§n', weight: 0.04 },
            { name: 'Lund', region: 'Sk√•ne l√§n', weight: 0.03 },
            { name: 'Ume√•', region: 'V√§sterbottens l√§n', weight: 0.03 },
            { name: 'G√§vle', region: 'G√§vleborgs l√§n', weight: 0.03 },
            { name: 'Bor√•s', region: 'V√§stra G√∂talands l√§n', weight: 0.03 },
            { name: 'Eskilstuna', region: 'S√∂dermanlands l√§n', weight: 0.02 }
        ];

        const socialClasses = [
            {
                name: 'arbetarklass',
                weight: 0.40,
                opportunitiesModifier: 0.85,
                initialCapital: { economic: 20, cultural: 15, social: 25, symbolic: 5 }
            },
            {
                name: 'medelklass',
                weight: 0.45,
                opportunitiesModifier: 1.0,
                initialCapital: { economic: 50, cultural: 30, social: 30, symbolic: 15 }
            },
            {
                name: '√∂verklass',
                weight: 0.15,
                opportunitiesModifier: 1.3,
                initialCapital: { economic: 120, cultural: 50, social: 40, symbolic: 35 }
            }
        ];

        // Historical Events
        const historicalEvents = {
            '1960-tal': [
                "1963: Alla svenska grundskolor blir samskolor.",
                "1967: Sverige inf√∂r h√∂gertrafik.",
                "1969: M√§nskligheten landar p√• m√•nen."
            ],
            '1970-tal': [
                "1971: Riksdagen blir enkammarriksdag.",
                "1973: Oljekrisen drabbar v√§rlden.",
                "1975: ABBA vinner Eurovision med 'Waterloo'."
            ],
            '1980-tal': [
                "1981: Sverige f√•r sin f√∂rsta kvinnliga statsminister, Thorbj√∂rn F√§lldin.",
                "1986: Olof Palme m√∂rdas i Stockholm.",
                "1989: Berlinmuren faller."
            ],
            '1990-tal': [
                "1991: Sovjetunionen uppl√∂ses.",
                "1994: Sverige g√•r med i EU.",
                "1995: Sverige vinner Eurovision med 'Take Me to Your Heaven'."
            ],
            '2000-tal': [
                "2001: Terrorattacken mot World Trade Center i New York.",
                "2008: Finanskrisen drabbar v√§rlden.",
                "2009: Sverige inf√∂r k√∂nsneutrala √§ktenskap."
            ],
            '2010-tal': [
                "2014: Sverige erk√§nner Palestina som stat.",
                "2016: Donald Trump blir USA:s president.",
                "2019: Greta Thunberg blir en global ikon f√∂r klimataktivism."
            ]
        };

        // Function to show character creation screen
        function showCharacterCreation() {
            document.getElementById('introScreen').style.display = 'none';
            document.getElementById('characterScreen').style.display = 'block';
            generateCharacter();
        }

        // Function to generate character
        function generateCharacter() {
            const gender = Math.random() < 0.5 ? 'man' : 'kvinna';
            const city = getRandomCity();
            const socialClass = getRandomSocialClass();

            const characterInfo = document.getElementById('characterInfo');
            characterInfo.innerHTML = `
                <h3>Din karakt√§r</h3>
                <p><strong>K√∂n:</strong> ${gender}</p>
                <p><strong>F√∂ddes i:</strong> ${city.name}, ${city.region}</p>
                <p><strong>Social klass:</strong> ${socialClass.name}</p>
            `;
        }

        // Function to get random city
        function getRandomCity() {
            const totalWeight = swedishCities.reduce((sum, city) => sum + city.weight, 0);
            let random = Math.random() * totalWeight;
            for (const city of swedishCities) {
                if (random < city.weight) {
                    return city;
                }
                random -= city.weight;
            }
            return swedishCities[0];
        }

        // Function to get random social class
        function getRandomSocialClass() {
            const totalWeight = socialClasses.reduce((sum, socialClass) => sum + socialClass.weight, 0);
            let random = Math.random() * totalWeight;
            for (const socialClass of socialClasses) {
                if (random < socialClass.weight) {
                    return socialClass;
                }
                random -= socialClass.weight;
            }
            return socialClasses[0];
        }

        // Function to confirm character and goal
        function confirmCharacterAndGoal() {
            const lifeGoal = document.querySelector('input[name="lifeGoal"]:checked').value;
            gameState.character = {
                lifeGoal: lifeGoal
            };
            document.getElementById('characterScreen').style.display = 'none';
            document.getElementById('gameplayScreen').style.display = 'block';
            initializeTimeline();
            updateDecadeHeader();
            renderCharacterDisplay();
        }

        // Function to initialize timeline
        function initializeTimeline() {
            const timelineGridContainer = document.getElementById('timelineGridContainer');
            timelineGridContainer.innerHTML = '';
            for (let i = 0; i < TIMELINE_TRACKS; i++) {
                const timelineTrack = document.createElement('div');
                timelineTrack.className = 'timeline-track';
                for (let j = 0; j < YEARS_PER_DECADE; j++) {
                    const yearCell = document.createElement('div');
                    yearCell.className = 'timeline-year-cell';
                    yearCell.textContent = j + 1;
                    yearCell.onclick = () => handleYearCellClick(i, j);
                    timelineTrack.appendChild(yearCell);
                }
                timelineGridContainer.appendChild(timelineTrack);
            }
        }

        // Function to handle year cell click
        function handleYearCellClick(trackIndex, yearIndex) {
            if (selectedProjectForPlacement) {
                const timelineTrack = document.querySelectorAll('.timeline-track')[trackIndex];
                const yearCell = timelineTrack.querySelectorAll('.timeline-year-cell')[yearIndex];
                if (!yearCell.classList.contains('occupied')) {
                    yearCell.classList.add('occupied');
                    yearCell.textContent = selectedProjectForPlacement.name;
                    yearCell.style.backgroundColor = getRandomColor();
                    selectedProjectForPlacement = null;
                }
            }
        }

        // Function to get random color
        function getRandomColor() {
            const letters = '0123456789ABCDEF';
            let color = '#';
            for (let i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }

        // Function to update decade header
        function updateDecadeHeader() {
            const decadeHeader = document.getElementById('decadeHeader');
            const currentDecade = gameState.decades[gameState.currentDecadeIndex];
            decadeHeader.innerHTML = `
                <h2>${currentDecade}</h2>
                <p>Du √§r nu ${gameState.age} √•r gammal.</p>
            `;
        }

        // Function to render character display
        function renderCharacterDisplay() {
            const characterDisplay = document.getElementById('characterDisplay');
            characterDisplay.innerHTML = `
                <h3>Din karakt√§r</h3>
                <div class="character-stats">
                    <div class="stat-item"><strong>Ekonomiskt kapital:</strong> ${gameState.capital.economic}</div>
                    <div class="stat-item"><strong>Kulturellt kapital:</strong> ${gameState.capital.cultural}</div>
                    <div class="stat-item"><strong>Socialt kapital:</strong> ${gameState.capital.social}</div>
                    <div class="stat-item"><strong>Symboliskt kapital:</strong> ${gameState.capital.symbolic}</div>
                    <div class="stat-item"><strong>H√§lsa:</strong> ${gameState.stats.health}</div>
                    <div class="stat-item"><strong>Lycka:</strong> ${gameState.stats.happiness}</div>
                </div>
            `;
        }

        // Function to close modal
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Function to clear current decade projects
        function clearCurrentDecadeProjects() {
            const timelineYearCells = document.querySelectorAll('.timeline-year-cell');
            timelineYearCells.forEach(cell => {
                cell.classList.remove('occupied');
                cell.textContent = parseInt(cell.textContent);
                cell.style.backgroundColor = '';
            });
        }

        // Function to complete decade
        function completeDecade() {
            document.getElementById('gameplayScreen').style.display = 'none';
            document.getElementById('reflectionScreen').style.display = 'block';
        }

        // Function to go to next decade
        function nextDecade() {
            gameState.currentDecadeIndex++;
            gameState.age += 10;
            document.getElementById('reflectionScreen').style.display = 'none';
            document.getElementById('gameplayScreen').style.display = 'block';
            updateDecadeHeader();
        }

        // Function to restart game
        function restartGame() {
            gameState = getDefaultGameState();
            document.getElementById('summaryScreen').style.display = 'none';
            document.getElementById('introScreen').style.display = 'block';
        }

        // Initialize game state
        gameState = getDefaultGameState();
    </script>
</body>
</html>
